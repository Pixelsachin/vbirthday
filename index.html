<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Happy Birthday</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        overflow: hidden;
        font-family: "Garamond", "Georgia", serif;
        background: #000;
        cursor: none;
      }
      /* LOADING SCREEN */
      #loadingScreen {
        position: fixed;
        inset: 0;
        background: #fffafc;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999999;
        font-family: "Chewy", cursive; /* cute font */
        transition: opacity 0.8s ease, visibility 0.8s ease;
      }

      /* LOADING TEXT */
      .loadingText {
        font-size: clamp(26px, 4vw, 40px);
        color: #d46a8a;
        letter-spacing: 1.2px;
        opacity: 0.85;
        animation: pulse 1.4s ease-in-out infinite;
      }

      /* cute pulse animation */
      @keyframes pulse {
        0% {
          transform: scale(1);
          opacity: 0.85;
        }
        50% {
          transform: scale(1.07);
          opacity: 1;
        }
        100% {
          transform: scale(1);
          opacity: 0.85;
        }
      }

      /* hidden state (JS will apply) */
      #loadingScreen.hide {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }

      :root {
        --final-font-size: 48px;
        --final-font-family: "Poppins", "Segoe UI", system-ui, -apple-system,
          sans-serif;
        --letter-delay: 120ms; /* matches JS default (visual hint) */
        --transition-duration: 1100ms; /* 1.1s transition for a slower, smoother pop */
        --hold-after-all: 4000ms;
        --word-gap: 14px; /* horizontal gap between words */
        --letter-gap: 3px; /* small gap between letters */
        --line-padding: 20px; /* vertical padding between wrapped lines */
        --gradient-start: #ff6b81; /* soft red/pink start */
        --gradient-end: #f8b4c6; /* soft pink end */
        --text-minimal-color: #f3edf0; /* minimal base color if gradient not possible */
        --flicker-duration: 1.8s; /* slower flicker loop */
      }
      /* Your font imports */
      @import url("https://fonts.googleapis.com/css2?family=Bangers&family=Chewy&family=Style+Script&display=swap");

      :root {
        --bg: #fffafc;
        --panel-bg: rgba(255, 255, 255, 0.6);
        --accent-1: #ffd7e1; /* pale pink */
        --accent-2: #ffeef6; /* softer pastel */
        --text: #3b2f35; /* gentle dark for readability */
        --muted: #8a7077;
      }

      /* Final Cute Page */
      #cuteFinalPage {
        display: none;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
        gap: 18px;
        position: relative;
        overflow: hidden;
        /* background: linear-gradient(180deg, var(--panel-bg), transparent); */
        background-color: #2d0a0a;
        padding: 36px 20px;

        /* Default font (fallback) */
        font-family: "Chewy", "Inter", system-ui, sans-serif;

        color: var(--text);
      }

      /* MAIN MESSAGE â€” using Chewy for cute aesthetic */
      #cuteMessage {
        opacity: 0;
        transform: translateY(8px);
        transition: opacity 520ms ease,
          transform 520ms cubic-bezier(0.2, 0.9, 0.3, 1);
        font-family: "Chewy", cursive;
        font-size: clamp(24px, 3.6vw, 46px);
        letter-spacing: 0.6px;
        text-align: center;
        max-width: 900px;
        line-height: 1.55;
      }

      /* SIGNATURE â€” using Style Script for elegant handwritten feel */
      #signature {
        opacity: 0;
        transform: translateY(6px) scale(0.99);
        transition: opacity 600ms ease 80ms,
          transform 600ms cubic-bezier(0.2, 0.9, 0.3, 1) 80ms;
        color: var(--muted);
        font-family: "Style Script", cursive;
        font-size: clamp(20px, 2.2vw, 32px);
        letter-spacing: 0.8px;
      }

      /* SHOW STATES */
      #cuteMessage.show {
        opacity: 1;
        transform: translateY(0);
      }
      #signature.show {
        opacity: 1;
        transform: translateY(0) scale(1);
      }

      /* FLOATING HEARTS */
      .floating-heart {
        position: absolute;
        bottom: -24px;
        pointer-events: none;
        user-select: none;
        opacity: 0.98;
        filter: drop-shadow(0 6px 12px rgba(210, 150, 170, 0.06));
        color: #ff6b8a;
        will-change: transform, opacity;
        animation-name: heartFloat;
        animation-timing-function: cubic-bezier(0.22, 0.9, 0.3, 1);
        animation-iteration-count: 1;
      }

      @keyframes heartFloat {
        0% {
          transform: translateY(0) translateX(0) scale(1);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        70% {
          transform: translateY(-60vh) translateX(8vw) rotate(-6deg) scale(1.02);
          opacity: 0.9;
        }
        100% {
          transform: translateY(-72vh) translateX(14vw) rotate(-12deg)
            scale(0.98);
          opacity: 0;
        }
      }

      /* Reduced motion accessibility */
      @media (prefers-reduced-motion: reduce) {
        .floating-heart {
          animation: none !important;
          opacity: 1;
          transform: translateY(-40vh) !important;
        }
        #cuteMessage,
        #signature {
          transition: none !important;
          transform: none !important;
          opacity: 1 !important;
        }
      }

      /* Container */
      .final-message {
        display: block;
        width: min(980px, 92%);
        margin: 36px auto;
        padding: 28px 22px; /* outer padding */
        text-align: center;
        perspective: 1000px;
        line-height: 1.6; /* extra line height for padding effect */
        /* Create vertical rhythm: space between wrapped lines (padding via pseudo-element) */
      }

      /* Each character */
      .final-letter {
        display: inline-block;
        opacity: 0;
        transform: scale(0.88) rotateY(-30deg) translateZ(-10px);
        font-size: var(--final-font-size);
        font-family: var(--final-font-family);
        line-height: 1;
        margin: 0 var(--letter-gap);
        white-space: pre; /* preserve spaces we insert as NBSP */
        transition: opacity 0.6s ease,
          transform var(--transition-duration)
            cubic-bezier(0.68, -0.55, 0.265, 1.55),
          filter var(--transition-duration) ease;
        --flicker-opacity: 0;
        transform-style: preserve-3d;
        backface-visibility: hidden;
        color: var(--text-minimal-color); /* fallback color */
        /* Gradient text */
        background: linear-gradient(
          90deg,
          var(--gradient-start),
          var(--gradient-end)
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        -webkit-text-fill-color: transparent;
        /* Subtle baseline glow (will be increased by JS) */
        filter: blur(1px) drop-shadow(0 0 6px rgba(160, 238, 77, 0.361));
      }

      /* Make spaces bigger: special class applied by JS */
      .final-letter.space {
        margin-right: var(--word-gap);
      }

      /* Make wrapped lines appear with padding between lines:
   approach: give the container extra line-height and padding. If you need
   actual block padding between wrapped lines you can wrap each logical
   line in a block element â€” but increased line-height + container padding
   typically gives the desired visual spacing. */
      .final-message {
        padding-block: calc(var(--line-padding) + 8px);
      }

      /* Flicker (slower, subtle) */
      @keyframes flicker {
        0% {
          opacity: var(--flicker-opacity);
        }
        12% {
          opacity: calc(var(--flicker-opacity) * 0.65);
        }
        28% {
          opacity: var(--flicker-opacity);
        }
        62% {
          opacity: calc(var(--flicker-opacity) * 0.85);
        }
        100% {
          opacity: var(--flicker-opacity);
        }
      }
      .final-letter[style*="--flicker-opacity: 1"] {
        animation: flicker var(--flicker-duration) steps(4, end) infinite;
      }

      /* Glitch animation (subtle) */
      .glitch {
        position: relative;
        animation: glitch-skew 550ms linear;
      }
      @keyframes glitch-skew {
        0% {
          transform: translateX(0) translateY(0) skewX(0deg);
        }
        20% {
          transform: translateX(-4px) translateY(-1px) skewX(-6deg);
        }
        40% {
          transform: translateX(3px) translateY(1px) skewX(4deg);
        }
        60% {
          transform: translateX(-2px) translateY(0) skewX(-2deg);
        }
        80% {
          transform: translateX(1px) translateY(-1px) skewX(1deg);
        }
        100% {
          transform: translateX(0) translateY(0) skewX(0deg);
        }
      }

      /* Horror or neon variants â€” toggled by adding a parent class 'horror' or 'neon' */
      .horror .final-letter {
        background: linear-gradient(90deg, #ff9aa2, #ffe3e8);
        filter: blur(0) drop-shadow(0 0 18px rgba(255, 50, 80, 0.18));
      }
      .neon .final-letter {
        background: linear-gradient(90deg, #6ef0d6, #9bffea);
        filter: blur(0) drop-shadow(0 0 16px rgba(110, 240, 214, 0.18));
      }

      /* Respect users who prefer reduced motion */
      @media (prefers-reduced-motion: reduce) {
        .final-letter {
          transition: none !important;
          animation: none !important;
          transform: none !important;
          opacity: 1 !important;
        }
      }

      .custom-cursor {
        position: fixed;
        width: 20px;
        height: 20px;
        border: 2px solid #ff0044;
        border-radius: 50%;
        pointer-events: none;
        z-index: 9999;
        transition: transform 0.1s;
        box-shadow: 0 0 20px #ff0044;
      }

      .container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(
          circle at 50% 50%,
          #2d0a0a 0%,
          #000000 100%
        );
      }

      .fog {
        position: fixed;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            ellipse at 10% 20%,
            rgba(80, 0, 20, 0.4) 0%,
            transparent 40%
          ),
          radial-gradient(
            ellipse at 90% 80%,
            rgba(60, 0, 30, 0.3) 0%,
            transparent 40%
          ),
          radial-gradient(
            ellipse at 50% 50%,
            rgba(40, 0, 20, 0.2) 0%,
            transparent 60%
          );
        animation: fogMove 25s ease-in-out infinite;
        pointer-events: none;
      }

      @keyframes fogMove {
        0%,
        100% {
          opacity: 0.4;
          transform: scale(1) rotate(0deg);
        }
        33% {
          opacity: 0.6;
          transform: scale(1.2) rotate(2deg);
        }
        66% {
          opacity: 0.5;
          transform: scale(1.1) rotate(-2deg);
        }
      }

      .vignette {
        position: fixed;
        width: 100%;
        height: 100%;
        box-shadow: inset 0 0 300px rgba(0, 0, 0, 0.95);
        pointer-events: none;
      }

      .lightning {
        position: fixed;
        width: 100%;
        height: 100%;
        background: #fff;
        opacity: 0;
        pointer-events: none;
        z-index: 50;
      }

      .spark {
        position: fixed;
        width: 3px;
        height: 3px;
        background: radial-gradient(circle, #ffaa00, #ff4400);
        border-radius: 50%;
        pointer-events: none;
        box-shadow: 0 0 10px #ff8800, 0 0 20px #ff6600;
        z-index: 8;
      }

      .title-reveal {
        position: relative;
        z-index: 100;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        padding: 20px;
      }

      .title-letter {
        font-size: clamp(45px, 9vw, 120px);
        font-weight: 900;
        color: #ff0055;
        text-shadow: 0 0 30px #ff0044, 0 0 60px #ff0044, 0 0 90px #ff0044,
          0 0 120px #cc0033, 5px 5px 15px rgba(0, 0, 0, 0.9);
        opacity: 0;
        transform: scale(0) rotateY(-180deg) translateZ(-200px);
        display: inline-block;
        filter: blur(15px);
        animation: flicker 0.1s infinite alternate;
      }

      @keyframes flicker {
        0%,
        100% {
          opacity: var(--flicker-opacity, 1);
        }
        50% {
          opacity: calc(var(--flicker-opacity, 1) * 0.95);
        }
      }

      .falling-element {
        position: fixed;
        font-size: 30px;
        pointer-events: none;
        filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        z-index: 10;
        opacity: 0.85;
      }

      .cake-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 90;
        font-size: clamp(80px, 15vw, 180px);
        filter: drop-shadow(0 0 30px rgba(255, 200, 0, 0.8));
        opacity: 0;
        transition: opacity 2s ease-in;
      }

      .cake-visible {
        opacity: 1;
      }

      .blood-drip {
        position: fixed;
        width: 3px;
        height: 0;
        background: linear-gradient(to bottom, #8b0000, #ff0000);
        border-radius: 0 0 50% 50%;
        opacity: 0.7;
        pointer-events: none;
        z-index: 5;
      }

      .final-message {
        display: none;
        text-align: center;
        z-index: 100;
        padding: 60px 40px;
        max-width: 85%;
        line-height: 1.6;
      }

      .final-letter {
        display: inline-block;
        font-size: clamp(28px, 4.5vw, 52px);
        font-weight: 700;
        background: linear-gradient(
          135deg,
          #ff0055 0%,
          #ff6699 50%,
          #ff0055 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        filter: drop-shadow(0 0 15px rgba(255, 0, 68, 0.8))
          drop-shadow(0 0 30px rgba(255, 0, 68, 0.6))
          drop-shadow(0 0 45px rgba(255, 0, 68, 0.4));
        opacity: 0;
        transform: scale(0) rotateY(-180deg) translateZ(-200px);
        margin: 0 2px;
        animation: flicker 0.1s infinite alternate;
      }

      /* STAGE 5: Cute Final Page */
      .cute-final-page {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(
          135deg,
          #ffeef8 0%,
          #fff5f7 50%,
          #ffe5f1 100%
        );

        z-index: 200;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px 40px;
      }

      .cute-message {
        font-family: "Georgia", serif;
        font-size: clamp(32px, 6vw, 72px);
        font-weight: 700;
        text-align: center;
        background: linear-gradient(
          135deg,
          #ff1493 0%,
          #ff69b4 50%,
          #ff1493 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: 2px;
        line-height: 1.4;
        margin-bottom: 80px;
        text-shadow: 2px 2px 4px rgba(255, 105, 180, 0.3);
        opacity: 0;
        transform: translateY(30px);
        transition: all 1s ease-out;
      }

      .cute-message.show {
        opacity: 1;
        transform: translateY(0);
      }

      .signature {
        position: absolute;
        bottom: 50px;
        right: 60px;
        font-family: "Georgia", serif;
        font-size: clamp(18px, 2.5vw, 28px);
        font-weight: 800;
        color: #333;
        text-align: right;
        line-height: 1.8;
        opacity: 0;
        transform: translateY(20px);
        transition: all 1s ease-out 0.5s;
      }

      .signature.show {
        opacity: 1;
        transform: translateY(0);
      }

      .floating-hearts {
        position: fixed;
        font-size: 30px;
        pointer-events: none;
        z-index: 201;
        opacity: 0.7;
      }

      .glitch {
        animation: glitchAnim 0.2s ease;
      }

      @keyframes glitchAnim {
        0% {
          transform: translate(0);
          filter: hue-rotate(0deg);
        }
        20% {
          transform: translate(-3px, 3px);
          filter: hue-rotate(90deg);
        }
        40% {
          transform: translate(3px, -3px);
          filter: hue-rotate(180deg);
        }
        60% {
          transform: translate(-3px, -3px);
          filter: hue-rotate(270deg);
        }
        80% {
          transform: translate(3px, 3px);
          filter: hue-rotate(360deg);
        }
        100% {
          transform: translate(0);
          filter: hue-rotate(0deg);
        }
      }

      .pulse-bg {
        animation: pulseBg 0.5s ease-out;
      }

      @keyframes pulseBg {
        0%,
        100% {
          background: radial-gradient(
            circle at 50% 50%,
            #2d0a0a 0%,
            #000000 100%
          );
        }
        50% {
          background: radial-gradient(
            circle at 50% 50%,
            #4d0a0a 0%,
            #1a0000 100%
          );
        }
      }

      .particle {
        position: fixed;
        width: 4px;
        height: 4px;
        background: #ff0044;
        border-radius: 50%;
        pointer-events: none;
        box-shadow: 0 0 10px #ff0044;
        z-index: 5;
      }

      @media (max-width: 768px) {
        .signature {
          bottom: 30px;
          right: 30px;
          font-size: clamp(14px, 2vw, 20px);
        }

        .final-message {
          padding: 40px 20px;
        }

        .cute-final-page {
          padding: 40px 20px;
        }
      }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- Stylish, readable font (Poppins as example) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- LOADING SCREEN -->
    <div id="loadingScreen">
      <span class="loadingText">Sawar Rakhoâ€¦</span>
    </div>

    <div class="custom-cursor" id="cursor"></div>
    <div class="container" id="mainContainer">
      <div class="fog"></div>
      <div class="vignette"></div>
      <div class="lightning" id="lightning"></div>

      <div class="cake-container" id="cakeContainer">ðŸŽ‚</div>
      <div class="title-reveal" id="titleReveal"></div>
      <!-- put this in your HTML head -->

      <!-- in your body where final message should appear -->
      <!-- stage 4 -->
      <div
        id="finalMessage"
        class="final-message"
        aria-live="polite"
        role="status"
      ></div>
    </div>

    <!-- STAGE 5: Cute Final Page -->
    <div class="cute-final-page" id="cuteFinalPage">
      <div class="cute-message" id="cuteMessage">
        Thanks for being in my life
      </div>
      <div class="signature" id="signature">
        â€” best wishes by<br /><b>Haddy Mere Buddy</b>
      </div>
    </div>

    <script>
      window.addEventListener("load", () => {
        const loader = document.getElementById("loadingScreen");

        // delay is optional (looks smoother)
        setTimeout(() => {
          loader.classList.add("hide");
        }, 400);
      });

      const titleText = "HAPPY BIRTHDAY MY LADIE";
      const finalText =
        "Janam din mubarak bhootni, Kaafi din ho gaya hum dono ko dost bane, aur tab se tu har roz apni harkaton se mujhe daraati, satati aur phir bhi hassaa te rehti hai.";
      const stickers = ["ðŸŒ¸", "ðŸŽˆ", "âœ¨", "ðŸŽ€"];

      let stage2Interval;
      let elementsArray = [];
      let sparkInterval;
      let stickerInterval;

      // Custom cursor
      document.addEventListener("mousemove", (e) => {
        const cursor = document.getElementById("cursor");
        cursor.style.left = e.clientX + "px";
        cursor.style.top = e.clientY + "px";
      });

      // Lightning flash
      function triggerLightning() {
        const lightning = document.getElementById("lightning");
        lightning.style.opacity = "0.4";
        setTimeout(() => (lightning.style.opacity = "0"), 50);
        setTimeout(() => {
          lightning.style.opacity = "0.3";
          setTimeout(() => (lightning.style.opacity = "0"), 30);
        }, 100);
      }

      // Particle burst
      function createParticleBurst(x, y, count = 20) {
        for (let i = 0; i < count; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = x + "px";
          particle.style.top = y + "px";
          document.body.appendChild(particle);

          const angle = (Math.PI * 2 * i) / count;
          const velocity = 100 + Math.random() * 100;
          const vx = Math.cos(angle) * velocity;
          const vy = Math.sin(angle) * velocity;

          let px = x,
            py = y,
            life = 1;
          function animateParticle() {
            life -= 0.02;
            if (life <= 0) {
              particle.remove();
              return;
            }
            px += vx * 0.016;
            py += vy * 0.016 + 50 * 0.016;
            particle.style.left = px + "px";
            particle.style.top = py + "px";
            particle.style.opacity = life;
            requestAnimationFrame(animateParticle);
          }
          animateParticle();
        }
      }

      // Firecracker sparks
      function createSpark() {
        const spark = document.createElement("div");
        spark.className = "spark";

        const startX = Math.random() * window.innerWidth;
        const startY = Math.random() * window.innerHeight;

        spark.style.left = startX + "px";
        spark.style.top = startY + "px";
        document.body.appendChild(spark);

        const angle = Math.random() * Math.PI * 2;
        const speed = 2 + Math.random() * 4;
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed - 1;

        let x = startX,
          y = startY,
          life = 1;

        function animateSpark() {
          life -= 0.015;
          if (life <= 0) {
            spark.remove();
            return;
          }

          x += vx;
          y += vy + (1 - life) * 2;

          spark.style.left = x + "px";
          spark.style.top = y + "px";
          spark.style.opacity = life;
          spark.style.transform = `scale(${life})`;

          requestAnimationFrame(animateSpark);
        }
        animateSpark();
      }

      function startFirecrackers() {
        sparkInterval = setInterval(() => {
          const sparkCount = 2 + Math.floor(Math.random() * 3);
          for (let i = 0; i < sparkCount; i++) {
            createSpark();
          }
        }, 150);
      }

      // Falling stickers
      function createFallingSticker() {
        const el = document.createElement("div");
        el.className = "falling-element";
        el.textContent = stickers[Math.floor(Math.random() * stickers.length)];

        el.style.left = Math.random() * 100 + "vw";
        el.style.top = "-50px";
        el.style.fontSize = 20 + Math.random() * 15 + "px";

        document.body.appendChild(el);
        elementsArray.push(el);

        const duration = 8000 + Math.random() * 4000;
        const rotation = Math.random() * 360 - 180;
        const drift = (Math.random() - 0.5) * 100;

        let start = null;
        function animate(timestamp) {
          if (!start) start = timestamp;
          const progress = (timestamp - start) / duration;

          if (progress < 1) {
            el.style.top = progress * 120 + "vh";
            el.style.transform = `translateX(${drift * progress}px) rotate(${
              rotation * progress
            }deg)`;
            el.style.opacity = 0.85 - progress * 0.5;
            requestAnimationFrame(animate);
          } else {
            el.remove();
            elementsArray = elementsArray.filter((e) => e !== el);
          }
        }
        requestAnimationFrame(animate);
      }

      function startGentleStickerFall() {
        stickerInterval = setInterval(createFallingSticker, 2000);
      }

      // Blood drip
      function createBloodDrip() {
        const drip = document.createElement("div");
        drip.className = "blood-drip";
        drip.style.left = Math.random() * 100 + "vw";
        drip.style.top = "0";
        document.body.appendChild(drip);

        let height = 0;
        const maxHeight = 100 + Math.random() * 200;
        const speed = 2 + Math.random() * 3;

        function animateDrip() {
          height += speed;
          if (height >= maxHeight) {
            drip.remove();
            return;
          }
          drip.style.height = height + "px";
          requestAnimationFrame(animateDrip);
        }
        animateDrip();
      }

      // STAGE 1
      function startStage1() {
        const titleDiv = document.getElementById("titleReveal");
        const letters = titleText.split("");

        letters.forEach((char, i) => {
          const span = document.createElement("span");
          span.className = "title-letter";
          span.textContent = char === " " ? "\u00A0" : char;
          span.style.setProperty("--flicker-opacity", 0);
          titleDiv.appendChild(span);

          setTimeout(() => {
            span.style.transition =
              "all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55)";
            span.style.opacity = "1";
            span.style.transform = "scale(1) rotateY(0deg) translateZ(0)";
            span.style.filter = "blur(0)";
            span.style.setProperty("--flicker-opacity", 1);

            if (Math.random() > 0.6) {
              span.classList.add("glitch");
              setTimeout(() => span.classList.remove("glitch"), 200);
            }

            const rect = span.getBoundingClientRect();
            if (Math.random() > 0.7) {
              createParticleBurst(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                10
              );
            }

            if (Math.random() > 0.85) {
              triggerLightning();
            }
          }, i * 350);
        });

        setTimeout(startStage2, 10000);
      }

      // STAGE 2
      function startStage2() {
        document.getElementById("titleReveal").style.transition =
          "opacity 1.5s, transform 1.5s";
        document.getElementById("titleReveal").style.opacity = "0";
        document.getElementById("titleReveal").style.transform = "scale(0.8)";

        setTimeout(() => {
          document.getElementById("titleReveal").style.display = "none";

          const cake = document.getElementById("cakeContainer");
          cake.classList.add("cake-visible");

          createParticleBurst(
            window.innerWidth / 2,
            window.innerHeight / 2,
            40
          );
        }, 1500);

        setInterval(createBloodDrip, 3000);
        setTimeout(startStage3, 6000);
      }

      // STAGE 3
      function startStage3() {
        triggerLightning();
        setTimeout(triggerLightning, 200);

        const container = document.getElementById("mainContainer");
        container.classList.add("pulse-bg");

        const cake = document.getElementById("cakeContainer");
        cake.style.transition = "all 1s cubic-bezier(0.68, -0.55, 0.265, 1.55)";
        cake.style.transform = "translate(-50%, -50%) scale(0) rotate(720deg)";
        cake.style.opacity = "0";

        elementsArray.forEach((el, i) => {
          setTimeout(() => {
            const direction = Math.random() > 0.5 ? 1 : -1;
            el.style.transition =
              "all 1s cubic-bezier(0.68, -0.55, 0.265, 1.55)";
            el.style.transform = `translateX(${
              direction * 3000
            }px) translateY(${-500 + Math.random() * 1000}px) rotate(${
              Math.random() * 1440
            }deg) scale(0)`;
            el.style.opacity = "0";
            el.style.filter = "blur(30px)";
          }, i * 20);
        });

        setTimeout(() => {
          createParticleBurst(
            window.innerWidth / 2,
            window.innerHeight / 2,
            50
          );
        }, 500);

        setTimeout(() => {
          container.classList.remove("pulse-bg");
          startStage4();
        }, 1200);
      }

      // STAGE 4
      // Assumptions:
      // - finalText: string containing the message to display
      // - elementsArray: array to clear previous elements (can be [])
      // - startStage5: function to call after animation ends

      function startStage4() {
        // CONFIG: tune to taste
        const letterDelay = 120; // ms between letters (increased for slower reveal)
        const transitionDuration = 1100; // ms transition (1.1s)
        const holdAfterAll = 4000; // ms after last letter before moving to stage5
        const glitchProbability = 0.55; // chance to apply glitch to a letter (0-1)
        const finalDiv = document.getElementById("finalMessage");

        if (!finalDiv) {
          console.warn("startStage4: #finalMessage not found");
          return;
        }

        // Clear previous elements and reset container
        if (Array.isArray(elementsArray)) {
          elementsArray.forEach((el) => el.remove());
          elementsArray.length = 0;
        }
        finalDiv.style.display = "block";
        finalDiv.innerHTML = ""; // start fresh

        // Ensure finalText is a string
        const text = String(finalText || "");
        // We'll preserve spaces as NBSP so they show up and we can style them
        const letters = text.split("");

        letters.forEach((char, i) => {
          const span = document.createElement("span");
          span.className = "final-letter";

          // Use a non-breaking space for actual space characters and a 'space' class
          if (char === " ") {
            span.textContent = "\u00A0";
            span.classList.add("space");
          } else {
            span.textContent = char;
          }

          // Initial flicker off
          span.style.setProperty("--flicker-opacity", "0");
          // Keep transitions consistent with JS config
          span.style.transition = `opacity 600ms ease, transform ${transitionDuration}ms cubic-bezier(0.68, -0.55, 0.265, 1.55), filter ${transitionDuration}ms ease`;

          finalDiv.appendChild(span);

          // Reveal each letter with stagger
          setTimeout(() => {
            span.style.opacity = "1";
            span.style.transform = "scale(1) rotateY(0deg) translateZ(0)";
            // Soft glow + slightly subtle (minimal)
            span.style.filter =
              "blur(0) drop-shadow(0 0 10px rgba(255,110,140,0.12)) drop-shadow(0 0 18px rgba(255,110,140,0.08))";
            span.style.setProperty("--flicker-opacity", "1");

            // Random, subtle glitch occasionally
            if (Math.random() > glitchProbability) {
              span.classList.add("glitch");
              setTimeout(() => span.classList.remove("glitch"), 600);
            }
          }, i * letterDelay);
        });

        // After all letters + hold -> stage 5
        const totalDelay = letters.length * letterDelay + holdAfterAll;
        setTimeout(() => {
          if (typeof startStage5 === "function") startStage5();
        }, totalDelay);
      }

      // STAGE 5: Cute Final Page
      function startStage5() {
        clearInterval(sparkInterval);
        clearInterval(stickerInterval);

        const mainContainer = document.getElementById("mainContainer");
        mainContainer.style.transition = "opacity 1.5s";
        mainContainer.style.opacity = "0";

        setTimeout(() => {
          mainContainer.style.display = "none";

          const cutePage = document.getElementById("cuteFinalPage");
          cutePage.style.display = "flex";
          document.body.style.cursor = "auto";
          mainContainer.style.backgroundColor = document.body.style.cursor =
            "auto";
          document.getElementById("cursor").style.display = "none";

          // Floating hearts
          function createFloatingHeart() {
            const heart = document.createElement("div");
            heart.className = "floating-hearts";
            heart.textContent = ["ðŸ’•", "ðŸ’–", "ðŸ’—", "ðŸ’"][
              Math.floor(Math.random() * 4)
            ];
            heart.style.left = Math.random() * 100 + "vw";
            heart.style.bottom = "-50px";
            heart.style.fontSize = 20 + Math.random() * 30 + "px";
            cutePage.appendChild(heart);

            let bottom = -50;
            const speed = 1 + Math.random() * 2;

            function animateHeart() {
              bottom += speed;
              if (bottom > window.innerHeight + 50) {
                heart.remove();
                return;
              }
              heart.style.bottom = bottom + "px";
              heart.style.transform = `translateX(${
                Math.sin(bottom / 30) * 30
              }px) rotate(${bottom}deg)`;
              requestAnimationFrame(animateHeart);
            }
            animateHeart();
          }

          setInterval(createFloatingHeart, 500);

          setTimeout(() => {
            document.getElementById("cuteMessage").classList.add("show");
            document.getElementById("signature").classList.add("show");
          }, 100);
        }, 1500);
      }

      // Initialize
      startFirecrackers();
      startGentleStickerFall();
      startStage1();
    </script>
  </body>
</html>
